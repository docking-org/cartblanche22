{% extends 'base.html' %}
{% block scripts %}
    {{ super() }}
    <script src="../static/js/custom/api.js"></script>
    <script src="../static/js/custom/cart.js"></script>
    <script>
        $(document).ready(() => {
            let data = {{data_|safe}}
                console.log(data)
            let cart = JSON.parse(localStorage.getItem('cart'))
            for (let i = 0; i < data.length; i++) {
                let index = cart.findIndex(item => item.identifier == data[i].zinc_id)
                if (index != -1) {
                    let btn = $('#' + data[i].zinc_id)
                    btn.addClass('added')
                }
            }
        });

        function addAllToCart(button, data) {
            let btn = $(button)
            if (btn.hasClass('addAllZinc')) {
                btn.removeClass('addAllZinc')
                btn.html("Add all to cart")
                btn.removeClass('btn-danger')
                btn.addClass('btn-info')
                console.log('deleted all from cart')
                for (let i = 0; i < data.length; i++) {
                    removeZinc(data[i])
                }
            } else {
                btn.addClass('addAllZinc')
                btn.html("Remove all from cart")
                btn.removeClass('btn-info')
                btn.addClass('btn-danger')
                $('.zinc-results').addClass('addZinc')
                console.log('added all to cart')
                for (let i = 0; i < data.length; i++) {
                    addZinc(data[i])
                }
            }
        }

        function removeZinc(data) {
            let item = {}
            item.identifier = data.zinc_id
            item.db = 'zinc22'
            item.img = 'https://sw.docking.org/depict/svg?w=50&h=30h&smi=' + data.smiles + '&qry=%q&cols=%c&cmap=%m&bgcolor=clear&hgstyle=outerglow'
            item.supplier = []
            let btn = $('#' + item.identifier)
            btn.removeClass('added')
            let cart = JSON.parse(localStorage.getItem('cart'))
            let index = cart.findIndex(i => i.identifier == item.identifier)
            if (index != -1) {
                cart.splice(index, 1)
                console.log('deleted from cart')
            }
            localStorage.setItem('cart', JSON.stringify(cart))
            $('#cartCount').html(getCartSize(cart))

        }

        function addZinc(data) {
            let item = {}
            item.identifier = data.zinc_id
            item.db = 'zinc22'
            item.img = 'https://sw.docking.org/depict/svg?w=50&h=30h&smi=' + data.smiles + '&qry=%q&cols=%c&cmap=%m&bgcolor=clear&hgstyle=outerglow'
            item.supplier = []
            let btn = $('#' + item.identifier)
            btn.addClass('added')
            let cart = JSON.parse(localStorage.getItem('cart'))
            let index = cart.findIndex(i => i.identifier == item.identifier)
            if (index == -1) {
                cart.push(item)
                console.log('added cart')
            }
            localStorage.setItem('cart', JSON.stringify(cart))
            $('#cartCount').html(getCartSize(cart))


        }

        function zincToggle(button, data) {
            let btn = $(button)

            if (btn.hasClass('added')) {
                removeZinc(data)
            } else {
                addZinc(data)
            }
        }

    </script>
{% endblock %}
{% block styles %}
    {{ super() }}
    <style>
        {#h5 {#}
        {#    text-align: center;#}
        .zinc-results {
            opacity: 1;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 20px;
            text-align: center;
        }

        .added {
            border: 1px solid #5bc0de;
            background-color: #9bd8eb;
        }


        .zinc-results :hover {
            opacity: 0.6;
        }


    </style>
{% endblock %}
{% block app_content %}
    <div class="row">
        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 col-xl-6">
            <h5>We found {{ data_| length }} matches</h5>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 col-xl-6 pull-right">
            <button class="btn btn-info pull-right" onclick="addAllToCart(this, {{ data_|safe }})">
                Add all to cart
            </button>
            {% if search == 'zinc' %}
                <a class="pull-right" href="{{ url_for('main.downloadZincListResult',value=value) }}">
                    <button class="btn btn-info" name="Search">
                        Download <i class="fa fa-download fa-x" aria-hidden="true"></i>
                    </button>
                </a>
            {% elif search == 'supplier' %}
                <a class="pull-right" href="{{ url_for('main.downloadSupplierResult',value=value) }}">
                    <button class="btn btn-info" name="Search">
                        Download <i class="fa fa-download fa-x" aria-hidden="true"></i>
                    </button>
                </a>
            {% endif %}
        </div>

    </div>
    <br>
    <div class="row">
        {% for data in data_ %}
            <div class="col-xs-6 col-sm-4 col-md-3 col-lg-2 col-xl-2">
                <div class="zinc-results" onclick="zincToggle(this, {{ data|safe }})" id={{ data.zinc_id }}>
                    <h5 class="caption">
                        <a href="/searchZinc/{{ data.zinc_id }}" title="More about">{{ data.zinc_id }}
                            <div class="small name">

                                <abbr title="Name">
                                    <nobr></nobr>
                                </abbr>

                            </div>
                        </a>
                        <img src="https://sw.docking.org/depict/svg?w=50&h=30h&smi={{ data.smiles }}&qry=%q&cols=%c&cmap=%m&bgcolor=clear&hgstyle=outerglow"
                             alt="zincid" style="width:100%; height: 15vh">
                        <div class="zinc-tile annotation small">
                            <ul style="word-wrap: break-word;list-style-type:none;"
                                class="list-group list-group-flush">
                                {% if not data.zinc_id %}
                                    <li class=""> {{ data.smiles }}</li>
                                    <li class=""> {{ data.sub_id }}</li>
                                    {#                                        <li class=""> H22P220</li>#}
                                {% endif %}
                            </ul>

                        </div>
                    </h5>
                    <p><i class="fa fa-check-circle fa-x cart-icon" aria-hidden="true" style="display: none"></i></p>
                </div>
            </div>
        {% endfor %}
    </div>

{% endblock %}