{% extends 'base.html' %}
{% block scripts %}
{{ super() }}
<script>
$(document).ready(() => {
    let data = {{data_|safe}}
    console.log(data)
    let cart = JSON.parse(localStorage.getItem('cart'))
    for(let i = 0; i < data.length; i++){
        let index = cart.findIndex(item => item.identifier == data[i].zinc_id)
        if (index != -1) {
                let btn = $('#' + data[i].zinc_id)
                btn.addClass('added')
        }
    }
});
function smileToggle(button, data){
    let btn = $(button)

    if (btn.hasClass('added')){
        removeSmile(data)
    }
    else{
        addSmile(data)
    }
}
function removeSmile(data){
     let item = {}
        item.identifier = data.zinc_id
        item.db = ''
        item.img = 'https://sw.docking.org/depict/svg?w=50&h=30h&smi=' + data.hitMappedSmiles + '&qry=%q&cols=%c&cmap=%m&bgcolor=clear&hgstyle=outerglow'
        item.supplier = []
    let btn = $('#' + item.identifier)
    btn.removeClass('added')
    let cart = JSON.parse(localStorage.getItem('cart'))
    let index = cart.findIndex(i => i.identifier == item.identifier)
    if (index != -1) {
        cart.splice(index, 1)
        console.log('deleted from cart')
    }
    localStorage.setItem('cart', JSON.stringify(cart))
        $('#cartCount').html(getCartSize(cart))

}
function addSmile(data){
     let item = {}
        item.identifier = data.zinc_id
        item.db = ''
        item.img = 'https://sw.docking.org/depict/svg?w=50&h=30h&smi=' + data.hitMappedSmiles + '&qry=%q&cols=%c&cmap=%m&bgcolor=clear&hgstyle=outerglow'
        item.supplier = []
    let btn = $('#' + item.identifier)
    btn.addClass('added')
    let cart = JSON.parse(localStorage.getItem('cart'))
    let index = cart.findIndex(i => i.identifier == item.identifier)
    if (index == -1) {
        cart.push(item)
        console.log('added cart')
    }
    localStorage.setItem('cart', JSON.stringify(cart))
        $('#cartCount').html(getCartSize(cart))

}
function addAllToCart(button, data) {
    let btn = $(button)
    if (btn.hasClass('addAllZinc')){
        btn.removeClass('addAllZinc')
        btn.html("Add all to cart")
        btn.removeClass('btn-danger')
        btn.addClass('btn-info')
        console.log('deleted all from cart')
         for(let i = 0; i < data.length; i++){
            removeSmile(data[i])
        }
    }
    else{
        btn.addClass('addAllZinc')
        btn.html("Remove all from cart")
        btn.removeClass('btn-info')
        btn.addClass('btn-danger')
        $('.zinc-results').addClass('addZinc')
        console.log('added all to cart')
        for(let i = 0; i < data.length; i++){
            addSmile(data[i])
        }
    }
}
</script>
{% endblock %}
{% block styles %}
      {{ super() }}
    <style>
    {#h5 {#}
    {#    text-align: center;#}
    .zinc-results{
        opacity: 1;
        border: 1px solid #ccc;
        border-radius: 4px;
        margin-bottom: 20px;
        text-align: center;
    }
    .added{
        border: 1px solid #5bc0de;
        background-color: #9bd8eb;
    }


    .zinc-results :hover{
        opacity: 0.6;
    }


    </style>
{% endblock %}
{% block app_content %}
    <div class="row">
    <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 col-xl-6">
                 <h5>We found {{ data_| length}} matches</h5>

         </div>
        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 col-xl-6 pull-right">
            <button class="btn btn-info pull-right" onclick="addAllToCart(this, {{ data_|safe }})" >
            Add all to cart
            </button>
        <a class="pull-right" href="{{ url_for('main.downloadSmilesResult', dist=dist, value=value) }}">
            <button class="btn btn-info" name="Search">
            Download <i class="fa fa-download fa-x" aria-hidden="true"></i>
            </button>
        </a>

        </div>

    </div>
    <br>
<div class="row">
 {%  for data in data_ %}
                <div class="col-xs-6 col-sm-4 col-md-3 col-lg-2 col-xl-2">
                    <div class="zinc-tile thumbnail" onclick="smileToggle(this, {{data|safe}})" id={{ data.zinc_id }}>
                        <h5 class="zinc-id caption">
                            <a href="{{ url_for('main.searchZinc', zinc_id = data.zinc_id ) }}" title="More about ZINC84687284">{{ data.zinc_id }}
                                <div class="small name">

                                    <abbr title="Name">
                                        <nobr></nobr>
                                    </abbr>

                                </div>
                                                            </a>


                                <img src="https://sw.docking.org/depict/svg?w=50&h=30h&smi={{ data.hitMappedSmiles }}&qry=%q&cols=%c&cmap=%m&bgcolor=clear&hgstyle=outerglow"
                                     alt="zincid" style="width:100%; height: 15vh">
                                <div class="zinc-tile annotation small">
                                    <ul style="word-wrap: break-word;list-style-type:none;text-align: center"
                                        class="list-group list-group-flush">
                                        <li class=""> {{ data.score }}</li>
{#                                        <li class=""> s_22__9598818__134210</li>#}
{#                                        <li class=""> H22P220</li>#}
                                    </ul>

                                </div>
                        </h5>
                    </div>
                </div>
            {% endfor %}

</div>

{% endblock %}